{% load static %}

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Почтовый ящик</title>
</head>
<body>
    <h1>Почтовый ящик</h1>
    <h2>Отправленные сообщения</h2>
    <ul>
        {% for message in sent_messages %}
            <li>
                <strong>Получатель:</strong> {{ message.recipient }}<br>
                <strong>Содержание:</strong> {{ message.content }}<br>
                <strong>Отправлено:</strong> {{ message.timestamp|date:"d.m.Y H:i" }}<br>
                {% if message.is_read %}
                    <span style="color: green;">Прочитано</span>
                {% else %}
                    <span style="color: red;">Не прочитано</span>
                {% endif %}
            </li>
        {% empty %}
            <li>Нет отправленных сообщений.</li>
        {% endfor %}
    </ul>

    <h2>Полученные сообщения</h2>
    <ul>
        {% for message in received_messages %}
            <li>
                <strong>От:</strong> {{ message.sender }}<br>
                <strong>Содержание:</strong> {{ message.content }}<br>
                <strong>Получено:</strong> {{ message.timestamp|date:"d.m.Y H:i" }}<br>
                {% if message.parent %}
                    <strong>Ответ на сообщение:</strong> {{ message.parent.content }}<br>
                {% endif %}
                {% if message.is_read %}
                    <span style="color: green;">Прочитано</span>
                {% else %}
                    <span style="color: red;">Не прочитано</span>
                    <!-- Форма для пометки как прочитанное -->
                    <form action="{% url 'mark_as_read' %}" method="post">
                        {% csrf_token %}
                        <input type="hidden" name="mail_id" value="{{ message.id }}">
                        <button type="submit">Пометить как прочитанное</button>
                    </form>
                {% endif %}
            </li>
        {% empty %}
            <li>Нет полученных сообщений.</li>
        {% endfor %}
    </ul>
</body>
</html>
